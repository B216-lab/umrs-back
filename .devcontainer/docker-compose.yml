services:
    app:
        build:
            context: .
            dockerfile: .devcontainer/Dockerfile
        volumes:
            - ..:/workspace:cached
            - gradle-cache:/home/vscode/.gradle
        command: >
            bash -lc "chown -R vscode:vscode /home/vscode/.gradle && exec sleep infinity"
        working_dir: /workspace
        environment:
            - GRADLE_USER_HOME=/home/vscode/.gradle
            - LOGGING_FILE_PATH=/workspace/logs
            - SERVER_PORT=8081
            - 'SPRING_PROFILES_ACTIVE=dev'
            - 'SPRING_DATASOURCE_URL=jdbc:postgresql://postgres:5432/mydatabase'
            - 'SPRING_DATASOURCE_USERNAME=myuser'
            - 'SPRING_DATASOURCE_PASSWORD=secret'
        ports:
            - '8081:8081'
        depends_on:
            postgres:
                condition: service_healthy
        healthcheck:
            test: ["CMD", "curl", "-f", "http://localhost:8081/actuator/health"]
            interval: 30s
            timeout: 10s
            retries: 5
        networks:
            - shared-net
            
volumes:
    gradle-cache:
    postgres-data:

networks:
    shared-net:
        external: true

