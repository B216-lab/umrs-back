version: '3.9'

services:
    app:
        build:
            context: ..
            dockerfile: .devcontainer/Dockerfile
        volumes:
            - ..:/workspace:cached
            - gradle-cache:/home/vscode/.gradle
        command: >
            bash -lc "chown -R vscode:vscode /home/vscode/.gradle && exec sleep infinity"
        working_dir: /workspace
        environment:
            - LOGGING_FILE_PATH=/workspace/logs
            - SERVER_PORT=8081
        ports:
            - '8081:8081'
        depends_on:
            - postgres
        networks:
            - shared-net

    postgres:
        image: 'postgis/postgis:18-3.6-alpine'
        environment:
            - 'POSTGRES_DB=mydatabase'
            - 'POSTGRES_PASSWORD=secret'
            - 'POSTGRES_USER=myuser'
        ports:
            - '32779:5432'
        volumes:
            - postgres-data:/var/lib/postgresql/data
        networks:
            - shared-net

volumes:
    gradle-cache:
    postgres-data:

networks:
    shared-net:
        external: true

